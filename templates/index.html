<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta tags for character encoding and responsive layout -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jellycat Store</title>

    <!-- Link to external CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <!-- Header Section -->
    <header class="header">
        <h1>Fuzzy Friends</h1>
        <p>Find the cutest stuffed animals!</p>
    </header>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <ul>
            <li><a class="active" href="{{ url_for('galleryPage') }}">Home</a></li>
            <li><a href="{{ url_for('viewBasket') }}">View Basket</a></li>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Contact</a></li>
        </ul>

        <!-- Search form (non-functional) -->
        <form class="search-form">
            <input type="text" placeholder="Search...">
            <button type="submit">Go</button>
        </form>
    </nav>

    <!-- Flash Message -->
    <div id="flash-message" class="popup-message" style="display: none;"></div>

    <script>
        window.onload = function () {
            const flashData = JSON.parse('{{ get_flashed_messages() | tojson | safe }}');
            if (flashData.length > 0) {
                const flashBox = document.getElementById("flash-message");
                flashBox.innerText = flashData[0];
                flashBox.style.display = "block";

                setTimeout(() => {
                    flashBox.style.display = "none";
                }, 3000);
            }
        };
    </script>

    <!-- Section title -->
    <h1 style="text-align: center;">Items for sale</h1>

    <!-- Sorting dropdown -->
    <form method="GET" action="{{ url_for('galleryPage') }}" class="sort-form">
        <label for="sort">Sort by:</label>
        <select name="sort" id="sort" onchange="this.form.submit()">
            <option value="name" {% if request.args.get('sort') == 'name' %}selected{% endif %}>Name</option>
            <option value="price" {% if request.args.get('sort') == 'price' %}selected{% endif %}>Price</option>
            <option value="carbon" {% if request.args.get('sort') == 'carbon' %}selected{% endif %}>Carbon Footprint</option>
        </select>
    </form>

    <!-- Items for sale -->
    <div class="items-container">
        {% for item in items_for_sale %}
            <div class="item-card" data-id="{{ item.id }}">
                <img src="{{ url_for('static', filename=item.image) }}" alt="{{ item.name }}">
                <h2>{{ item.name }}</h2>
                <p>Price: Â£{{ item.price }}</p>

                <form action="{{ url_for('add_to_basket', item_id=item.id) }}" method="POST" class="add-to-basket-form">
                    <button type="submit" class="button">Add to Basket</button>
                </form>

                <a href="{{ url_for('singleProductPage', item_id=item.id) }}" class="button">View Details</a>
            </div>
        {% endfor %}
    </div>

    <!-- Hidden description box -->
    <div id="description-box" class="description-box" style="display: none;"></div>

    <script>
        document.querySelectorAll('.item-card').forEach(card => {
            card.addEventListener('mouseenter', async () => {
                const id = card.getAttribute('data-id');
                const box = document.getElementById('description-box');
                try {
                    const response = await fetch(`/item-details/${id}`);
                    const data = await response.json();
                    if (data.description) {
                        box.innerHTML = data.description;
                        box.style.display = 'block';
                        const rect = card.getBoundingClientRect();
                        box.style.top = `${rect.top + window.scrollY - 10}px`;
                        box.style.left = `${rect.right + 10}px`;
                    }
                } catch (err) {
                    box.style.display = 'none';
                }
            });

            card.addEventListener('mouseleave', () => {
                document.getElementById('description-box').style.display = 'none';
            });
        });
    </script>
</body>
</html>

